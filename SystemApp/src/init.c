#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>

#include "init.h"
#include "cdc_console.h"
#include "keyboard.h"
#include "ff.h"

#include "ServiceGraphic.h"
#include "ServiceSTMPPartition.h"
#include "ServiceFlashMap.h"
#include "ServiceUSBDevice.h"
#include "ServiceFatFs.h"

/* Kernel includes. */
#include "FreeRTOS.h"
#include "task.h"
#include "queue.h"


const unsigned char HzString1[7][33] = {
	
	{'F', 0x00,0x00,0xFE,0x3F,0x82,0x20,0x82,0x20,0xFA,0x2F,0x82,0x20,0x82,0x20,0xF2,0x27,0x12,0x24,0x12,0x24,0x12,0x24,0xF2,0x27,0x12,0x24,0x02,0x20,0xFE,0x3F,0x02,0x20},/*"固",0*/
	{'F', 0x10,0x04,0x10,0x04,0x90,0x04,0x88,0x04,0x88,0x3F,0x4C,0x04,0x4C,0x04,0x2A,0x04,0x09,0x04,0xE8,0x7F,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04},/*"件",1*/
	{'F', 0x08,0x02,0x08,0x02,0x08,0x02,0xC8,0x7F,0x18,0x01,0x2A,0x09,0x0A,0x09,0x8A,0x48,0x89,0x4A,0x88,0x2A,0x48,0x09,0x48,0x14,0x28,0x14,0x08,0x22,0x08,0x21,0x88,0x40},/*"恢",2*/
	{'F', 0x08,0x00,0x08,0x00,0xF8,0x3F,0x04,0x00,0xFA,0x0F,0x09,0x08,0xF8,0x0F,0x08,0x08,0xF8,0x0F,0x20,0x00,0xF0,0x0F,0x18,0x04,0x26,0x02,0xC0,0x01,0x38,0x0E,0x07,0x70},/*"复",3*/
	{'F', 0x88,0x08,0x88,0x08,0xE8,0x3F,0x88,0x08,0x3F,0x00,0xC8,0x1F,0x4C,0x10,0xDC,0x1F,0x6A,0x10,0xCA,0x1F,0x09,0x02,0xE8,0x3F,0x08,0x05,0x88,0x08,0x48,0x10,0x28,0x60},/*"模",4*/
	{'F', 0x00,0x12,0x00,0x22,0x00,0x22,0x00,0x02,0xFF,0x7F,0x00,0x02,0x00,0x02,0x7C,0x02,0x10,0x02,0x10,0x02,0x10,0x04,0x10,0x44,0xF0,0x48,0x1E,0x50,0x04,0x60,0x00,0x40},/*"式",5*/
	{'F', 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x0C,0x00,0x00,0x00,0x0C,0x00,0x0C,0x00,0x00,0x00,0x00,0x00},/*"：",6*/


};

const unsigned char HzString2[53][33]={

	{'F',0x00,0x02,0x02,0x02,0xE4,0x3F,0x04,0x02,0xC0,0x1F,0x00,0x02,0xE7,0x7F,0x04,0x00,0xC4,0x1F,0x44,0x10,0xC4,0x1F,0x44,0x10,0xD4,0x1F,0x4C,0x10,0x44,0x14,0x40,0x08},/*"请",0*/
	{'F',0x08,0x02,0x08,0x02,0xF8,0x7F,0x04,0x02,0x04,0x02,0xE6,0x3F,0x26,0x22,0x25,0x22,0xE4,0x3F,0x04,0x02,0x44,0x02,0x84,0x02,0x04,0x01,0x84,0x02,0x44,0x0C,0x34,0x70},/*"使",1*/
	{'F',0x00,0x00,0xFC,0x1F,0x84,0x10,0x84,0x10,0x84,0x10,0xFC,0x1F,0x84,0x10,0x84,0x10,0x84,0x10,0xFC,0x1F,0x84,0x10,0x84,0x10,0x84,0x10,0x82,0x10,0x82,0x14,0x01,0x08},/*"用",2*/
	{'H',0x00,0x00,0x00,0xE7,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x3C,0x00,0x00},/*"U",3*/
	{'H',0x00,0x00,0x00,0x7C,0x42,0x42,0x02,0x04,0x18,0x20,0x40,0x42,0x42,0x3E,0x00,0x00},/*"S",4*/
	{'H',0x00,0x00,0x00,0x1F,0x22,0x22,0x22,0x1E,0x22,0x42,0x42,0x42,0x22,0x1F,0x00,0x00},/*"B",5*/
	{'F',0x00,0x02,0x04,0x02,0xE8,0x7F,0x08,0x01,0x00,0x05,0x80,0x04,0xCF,0x3F,0x08,0x04,0x08,0x04,0x08,0x04,0xE8,0x7F,0x08,0x04,0x08,0x04,0x14,0x04,0xE2,0x7F,0x00,0x00},/*"连",6*/
	{'F',0x08,0x01,0x08,0x02,0xC8,0x3F,0x08,0x00,0xBF,0x10,0x08,0x09,0xE8,0x7F,0x08,0x02,0x18,0x02,0xEC,0x7F,0x0B,0x11,0x88,0x10,0x08,0x09,0x08,0x06,0x8A,0x19,0x64,0x20},/*"接",7*/
	{'F',0x00,0x00,0xFE,0x3F,0x40,0x00,0x20,0x00,0x10,0x04,0x08,0x08,0xFC,0x1F,0x00,0x10,0x80,0x00,0x80,0x00,0xFC,0x1F,0x80,0x00,0x80,0x00,0x80,0x00,0xFF,0x7F,0x00,0x00},/*"至",8*/
	{'F',0x80,0x00,0x80,0x00,0x80,0x00,0xFC,0x1F,0x84,0x10,0x84,0x10,0x84,0x10,0xFC,0x1F,0x84,0x10,0x84,0x10,0x84,0x10,0xFC,0x1F,0x84,0x50,0x80,0x40,0x80,0x40,0x00,0x7F},/*"电",9*/
	{'F',0x00,0x02,0x1E,0x04,0x12,0x04,0xF2,0x7F,0x12,0x00,0x1E,0x00,0x12,0x09,0x52,0x2A,0x52,0x24,0x5E,0x24,0x52,0x2A,0x52,0x29,0x52,0x20,0x52,0x20,0xD2,0x3F,0x19,0x20},/*"脑",10*/
	{'F',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x0C,0x00,0x08,0x00,0x04,0x00,0x00,0x00},/*"，",11*/
	{'F',0x08,0x08,0x10,0x08,0x10,0x04,0x00,0x00,0xFE,0x3F,0x10,0x04,0x10,0x04,0x10,0x04,0x10,0x04,0xFF,0x7F,0x10,0x04,0x10,0x04,0x08,0x04,0x08,0x04,0x04,0x04,0x02,0x04},/*"并",12*/
	{'F',0x10,0x01,0x10,0x1F,0x90,0x10,0x52,0x08,0x14,0x05,0x14,0x02,0x10,0x09,0xD0,0x08,0x18,0x08,0xD4,0x7F,0x13,0x08,0x90,0x08,0x10,0x09,0x10,0x08,0x10,0x0A,0x10,0x04},/*"将",13*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*" ",14*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},/*" ",15*/
	{'H',0x00,0x00,0x00,0x00,0x30,0x48,0x08,0x3E,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00},/*"f",16*/
	{'H',0x00,0x00,0x00,0x0C,0x0C,0x00,0x00,0x0E,0x08,0x08,0x08,0x08,0x08,0x3E,0x00,0x00},/*"i",17*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x77,0x4C,0x04,0x04,0x04,0x04,0x1F,0x00,0x00},/*"r",18*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x92,0x92,0x92,0x92,0x92,0xB7,0x00,0x00},/*"m",19*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xDB,0x91,0x52,0x5A,0x2A,0x24,0x24,0x00,0x00},/*"w",20*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x22,0x30,0x2C,0x22,0x32,0x6C,0x00,0x00},/*"a",21*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x77,0x4C,0x04,0x04,0x04,0x04,0x1F,0x00,0x00},/*"r",22*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x42,0x42,0x7E,0x02,0x42,0x3C,0x00,0x00},/*"e",23*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00,0x00},/*".",24*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x42,0x02,0x3C,0x40,0x42,0x3E,0x00,0x00},/*"s",25*/
	{'H',0x00,0x00,0x00,0x00,0x03,0x02,0x02,0x1A,0x26,0x42,0x42,0x42,0x26,0x1A,0x00,0x00},/*"b",26*/
	{'F',0x40,0x00,0x80,0x00,0x80,0x00,0xFF,0x7F,0x08,0x08,0x08,0x08,0x10,0x04,0x10,0x04,0x20,0x02,0x40,0x01,0x80,0x00,0x40,0x01,0x20,0x02,0x10,0x04,0x0C,0x18,0x03,0x60},/*"文",27*/
	{'F',0x10,0x04,0x10,0x04,0x90,0x04,0x88,0x04,0x88,0x3F,0x4C,0x04,0x4C,0x04,0x2A,0x04,0x09,0x04,0xE8,0x7F,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04},/*"件",28*/
	{'F',0x04,0x02,0x08,0x02,0x00,0x02,0x7F,0x01,0x04,0x7F,0x84,0x10,0x7C,0x11,0x24,0x11,0x24,0x11,0x24,0x0A,0x24,0x0A,0x24,0x04,0x22,0x0A,0x2A,0x11,0x91,0x20,0x40,0x40},/*"放",29*/
	{'F',0x00,0x00,0xFE,0x3F,0x40,0x00,0x20,0x00,0x10,0x04,0x08,0x08,0xFC,0x1F,0x00,0x10,0x80,0x00,0x80,0x00,0xFC,0x1F,0x80,0x00,0x80,0x00,0x80,0x00,0xFF,0x7F,0x00,0x00},/*"至",0*/
	{'H',0x00,0x00,0x40,0x20,0x20,0x20,0x10,0x10,0x08,0x08,0x08,0x04,0x04,0x02,0x02,0x00},/*"/",31*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x63,0x42,0x42,0x42,0x42,0x62,0xDC,0x00,0x00},/*"u",32*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1B,0x26,0x42,0x42,0x42,0x26,0x1A,0x02,0x07},/*"p",33*/
	{'H',0x00,0x00,0x00,0x00,0x60,0x40,0x40,0x7C,0x42,0x42,0x42,0x42,0x62,0xDC,0x00,0x00},/*"d",34*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x22,0x30,0x2C,0x22,0x32,0x6C,0x00,0x00},/*"a",35*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x08,0x08,0x3E,0x08,0x08,0x08,0x08,0x48,0x30,0x00,0x00},/*"t",36*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x42,0x42,0x7E,0x02,0x42,0x3C,0x00,0x00},/*"e",37*/
	{'F',0x00,0x00,0xFC,0x1F,0x04,0x10,0x04,0x10,0x04,0x10,0xFC,0x1F,0x04,0x10,0x04,0x10,0x04,0x10,0xFC,0x1F,0x04,0x10,0x04,0x10,0x04,0x10,0x04,0x10,0xFC,0x1F,0x04,0x10},/*"目",38*/
	{'F',0x00,0x00,0xFC,0x0F,0x00,0x08,0x00,0x08,0xF8,0x0F,0x00,0x08,0x00,0x08,0xFF,0x7F,0x80,0x00,0x84,0x10,0x88,0x09,0xA0,0x06,0x90,0x04,0x8C,0x18,0xA3,0x60,0x40,0x00},/*"录",39*/
	{'F',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x0C,0x00,0x08,0x00,0x04,0x00,0x00,0x00},/*"，",40*/
	{'F',0x08,0x02,0x08,0x04,0x08,0x04,0xC8,0x7F,0x5F,0x40,0x28,0x22,0x08,0x02,0xD8,0x7F,0x0C,0x11,0x0B,0x11,0x88,0x10,0x08,0x0B,0x08,0x04,0x08,0x0A,0x0A,0x11,0xC4,0x20},/*"按",41*/
	{'F',0x00,0x00,0xFF,0x7F,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x02,0x40,0x04,0x40,0x08,0x40,0x10,0x40,0x10,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00,0x40,0x00},/*"下",42*/
	{'H',0x00,0x00,0x00,0x3F,0x42,0x12,0x12,0x1E,0x12,0x12,0x02,0x42,0x42,0x3F,0x00,0x00},/*"E",43*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3B,0x46,0x42,0x42,0x42,0x42,0xE7,0x00,0x00},/*"n",44*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x08,0x08,0x3E,0x08,0x08,0x08,0x08,0x48,0x30,0x00,0x00},/*"t",45*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x42,0x42,0x7E,0x02,0x42,0x3C,0x00,0x00},/*"e",46*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x77,0x4C,0x04,0x04,0x04,0x04,0x1F,0x00,0x00},/*"r",47*/
	{'F',0x04,0x08,0x04,0x08,0xDC,0x3E,0x84,0x28,0x82,0x7F,0x5E,0x28,0x45,0x3E,0xE4,0x08,0x9F,0x3E,0xA4,0x08,0xA4,0x7F,0x44,0x08,0x54,0x08,0xAC,0x00,0x14,0x7F,0x00,0x00},/*"键",48*/
	{'F',0x00,0x00,0xFE,0x3F,0x10,0x04,0x10,0x04,0x10,0x04,0x10,0x04,0x10,0x04,0xFF,0x7F,0x10,0x04,0x10,0x04,0x10,0x04,0x10,0x04,0x08,0x04,0x08,0x04,0x04,0x04,0x02,0x04},/*"开",49*/
	{'F',0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x02,0x3F,0x12,0x24,0x21,0xA4,0x7F,0x24,0x41,0x24,0x00,0x12,0x3F,0x14,0x21,0x08,0x21,0x14,0x21,0x22,0x21,0x01,0x3F,0x00,0x21},/*"始",50*/
	{'F',0x80,0x04,0xE0,0x05,0x3C,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0xFF,0x7F,0x20,0x04,0x20,0x04,0x20,0x04,0x10,0x04,0x10,0x04,0x08,0x04,0x04,0x04,0x02,0x04},/*"升",51*/
	{'F',0x08,0x00,0xC8,0x3F,0x04,0x21,0x04,0x11,0x12,0x11,0x1F,0x09,0x08,0x39,0x04,0x21,0x82,0x22,0x9F,0x22,0x82,0x14,0x80,0x14,0x58,0x08,0x47,0x14,0x22,0x22,0x80,0x41},/*"级",52*/



};


const unsigned char HzString3[5][33]={
	
	{'F',0x10,0x04,0x10,0x04,0xFE,0x3F,0x10,0x04,0x10,0x04,0xF0,0x07,0x10,0x04,0x10,0x04,0xF0,0x07,0x10,0x04,0x10,0x04,0xFF,0x7F,0x00,0x00,0x10,0x04,0x08,0x08,0x04,0x10},/*"其",0*/
	{'F',0x40,0x00,0x80,0x00,0xFE,0x7F,0x02,0x40,0x01,0x20,0x10,0x00,0x10,0x10,0x10,0x0C,0x90,0x03,0x70,0x00,0x10,0x00,0x10,0x20,0x10,0x20,0x10,0x20,0xE0,0x3F,0x00,0x00},/*"它",1*/
	{'F',0x00,0x02,0x44,0x02,0x48,0x02,0xC8,0x1F,0x20,0x02,0x00,0x02,0xEF,0x3F,0x88,0x04,0x88,0x04,0x88,0x04,0x48,0x24,0x48,0x24,0x28,0x38,0x14,0x00,0xE2,0x7F,0x00,0x00},/*"选",2*/
	{'F',0x00,0x00,0x80,0x7F,0x00,0x04,0x3F,0x02,0x88,0x3F,0x88,0x20,0x88,0x24,0x88,0x24,0x88,0x24,0x88,0x24,0x88,0x24,0xB8,0x22,0x07,0x0A,0x02,0x11,0x80,0x20,0x40,0x40},/*"项",3*/
	{'F',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x00,0x0C,0x00,0x00,0x00,0x0C,0x00,0x0C,0x00,0x00,0x00,0x00,0x00},/*"：",4*/
	
};

const unsigned char HzString4[12][33]={
	{'F',0x00,0x00,0x80,0x3F,0x80,0x1F,0x80,0x0F,0x80,0x07,0x80,0x07,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x07,0x80,0x07,0x80,0x0F,0x80,0x1F,0x80,0x3F,0x00,0x00},/*"【",0*/
	{'H',0x00,0x00,0x00,0x10,0x1C,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x7C,0x00,0x00},/*"1",1*/
	{'F',0x00,0x00,0xFC,0x01,0xF8,0x01,0xF0,0x01,0xE0,0x01,0xE0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xE0,0x01,0xE0,0x01,0xF0,0x01,0xF8,0x01,0xFC,0x01,0x00,0x00},/*"】",2*/
	{'F',0x04,0x01,0x04,0x02,0xE4,0x7F,0x24,0x40,0x5F,0x24,0xC4,0x3D,0x24,0x25,0x54,0x15,0xAC,0x08,0x47,0x17,0x24,0x20,0xD4,0x5F,0x04,0x02,0x44,0x12,0x25,0x22,0x02,0x03},/*"擦",3*/
	{'F',0x00,0x02,0x1E,0x02,0x12,0x05,0x8A,0x08,0x4A,0x10,0xA6,0x6F,0x0A,0x02,0x12,0x02,0xF2,0x3F,0x12,0x02,0x56,0x0A,0x4A,0x12,0x22,0x22,0x12,0x22,0x82,0x02,0x02,0x01},/*"除",4*/
	{'F',0x80,0x00,0x80,0x00,0x40,0x01,0x20,0x02,0x10,0x04,0x08,0x08,0xF4,0x17,0x83,0x60,0x80,0x00,0x80,0x00,0xF8,0x0F,0x80,0x00,0x80,0x00,0x80,0x00,0xFE,0x3F,0x00,0x00},/*"全",5*/
	{'F',0x00,0x02,0x08,0x02,0x08,0x02,0x08,0x02,0x08,0x02,0xF8,0x3F,0x08,0x00,0x08,0x00,0x08,0x00,0xF8,0x07,0x08,0x04,0x08,0x04,0x08,0x04,0x04,0x04,0x04,0x04,0x02,0x04},/*"片",6*/
	{'H',0x00,0x00,0x00,0x3F,0x42,0x12,0x12,0x1E,0x12,0x12,0x02,0x02,0x02,0x07,0x00,0x00},/*"F",7*/
	{'H',0x00,0x00,0x00,0x07,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x42,0x7F,0x00,0x00},/*"L",8*/
	{'H',0x00,0x00,0x00,0x08,0x08,0x18,0x14,0x14,0x24,0x3C,0x22,0x42,0x42,0xE7,0x00,0x00},/*"A",9*/
	{'H',0x00,0x00,0x00,0x7C,0x42,0x42,0x02,0x04,0x18,0x20,0x40,0x42,0x42,0x3E,0x00,0x00},/*"S",10*/
	{'H',0x00,0x00,0x00,0xE7,0x42,0x42,0x42,0x42,0x7E,0x42,0x42,0x42,0x42,0xE7,0x00,0x00},/*"H",11*/
};
const unsigned char HzString5[12][33]={
	{'F',0x00,0x00,0x80,0x3F,0x80,0x1F,0x80,0x0F,0x80,0x07,0x80,0x07,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x07,0x80,0x07,0x80,0x0F,0x80,0x1F,0x80,0x3F,0x00,0x00},/*"【",0*/
	{'H',0x00,0x00,0x00,0x3C,0x42,0x42,0x42,0x40,0x20,0x10,0x08,0x04,0x42,0x7E,0x00,0x00},/*"2",1*/
	{'F',0x00,0x00,0xFC,0x01,0xF8,0x01,0xF0,0x01,0xE0,0x01,0xE0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xE0,0x01,0xE0,0x01,0xF0,0x01,0xF8,0x01,0xFC,0x01,0x00,0x00},/*"】",2*/
	{'F',0x08,0x01,0x08,0x01,0x08,0x1F,0x88,0x10,0xDF,0x08,0x28,0x05,0x0C,0x02,0x1C,0x05,0xAA,0x18,0x4A,0x60,0xA9,0x1F,0x88,0x10,0x88,0x10,0x88,0x10,0x88,0x1F,0x88,0x10},/*"格",3*/
	{'F',0x00,0x12,0x00,0x22,0x00,0x22,0x00,0x02,0xFF,0x7F,0x00,0x02,0x00,0x02,0x7C,0x02,0x10,0x02,0x10,0x02,0x10,0x04,0x10,0x44,0xF0,0x48,0x1E,0x50,0x04,0x60,0x00,0x40},/*"式",4*/
	{'F',0x10,0x01,0x10,0x01,0x10,0x21,0x08,0x11,0x08,0x09,0x0C,0x05,0x0C,0x03,0x0A,0x01,0x89,0x01,0x48,0x01,0x28,0x01,0x08,0x41,0x08,0x41,0x08,0x41,0x08,0x7E,0x08,0x00},/*"化",5*/
	{'F',0x10,0x04,0x92,0x04,0x54,0x04,0x10,0x7C,0xFF,0x22,0x54,0x22,0x92,0x22,0x11,0x25,0x08,0x14,0x7F,0x14,0x44,0x08,0x42,0x08,0x26,0x14,0x18,0x14,0x2C,0x22,0x43,0x41},/*"数",6*/
	{'F',0x04,0x00,0xC4,0x3F,0x44,0x20,0x44,0x20,0xDF,0x3F,0x44,0x04,0x44,0x04,0xD4,0x7F,0x4C,0x04,0x47,0x04,0x44,0x3F,0x44,0x21,0x44,0x21,0x24,0x21,0x25,0x3F,0x12,0x21},/*"据",7*/
	{'F',0x00,0x00,0xFE,0x3F,0x02,0x00,0x02,0x08,0x22,0x08,0x42,0x04,0x82,0x02,0x02,0x01,0x82,0x02,0x42,0x04,0x22,0x08,0x12,0x08,0x02,0x00,0x02,0x00,0xFE,0x7F,0x00,0x00},/*"区",8*/
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00,0x00},
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00,0x00},
	{'H',0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00,0x00},
};

const unsigned char HzString6[6][33]={
	{'F',0x00,0x02,0x20,0x02,0x20,0x04,0x10,0x04,0x08,0x08,0x04,0x10,0x02,0x20,0xF9,0x47,0x20,0x04,0x20,0x04,0x20,0x04,0x10,0x04,0x10,0x04,0x08,0x04,0x84,0x02,0x02,0x01},/*"分",0*/
	{'F',0x00,0x00,0xFE,0x3F,0x02,0x00,0x02,0x08,0x22,0x08,0x42,0x04,0x82,0x02,0x02,0x01,0x82,0x02,0x42,0x04,0x22,0x08,0x12,0x08,0x02,0x00,0x02,0x00,0xFE,0x7F,0x00,0x00},/*"区",1*/
	{'F',0x00,0x00,0xFE,0x3F,0x00,0x01,0x00,0x01,0x80,0x00,0x80,0x00,0xC0,0x02,0xA0,0x04,0x90,0x08,0x88,0x10,0x84,0x20,0x82,0x20,0x81,0x00,0x80,0x00,0x80,0x00,0x80,0x00},/*"不",2*/
	{'F',0x20,0x00,0x20,0x00,0xFF,0x7F,0x10,0x00,0x10,0x00,0xC8,0x1F,0x08,0x08,0x0C,0x04,0x0A,0x02,0xE9,0x7F,0x08,0x02,0x08,0x02,0x08,0x02,0x08,0x02,0x88,0x02,0x08,0x01},/*"存",3*/
	{'F',0x40,0x00,0x40,0x00,0x20,0x00,0xFF,0x7F,0x10,0x00,0x10,0x02,0x08,0x02,0x0C,0x02,0xEA,0x3F,0x09,0x02,0x08,0x02,0x08,0x02,0x08,0x02,0x08,0x02,0xF8,0x7F,0x08,0x00},/*"在",4*/
	{'F',0x00,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x08,0x00,0x00,0x00,0x00,0x00},/*"！",5*/

};

const unsigned char HzString7[2][33] = {
	{'F',0x40,0x00,0x80,0x00,0xFE,0x7F,0x02,0x40,0x01,0x20,0xF8,0x0F,0x00,0x00,0x00,0x00,0xFE,0x3F,0x20,0x02,0x20,0x02,0x20,0x02,0x10,0x22,0x10,0x22,0x08,0x22,0x06,0x3C},/*"完",0*/
	{'F',0x00,0x0A,0x00,0x12,0x00,0x02,0xFC,0x7F,0x04,0x02,0x04,0x02,0x04,0x22,0x7C,0x22,0x44,0x22,0x44,0x14,0x44,0x14,0x44,0x48,0x54,0x4C,0x22,0x52,0x02,0x61,0x81,0x40},/*"成",1*/
};

const unsigned char HzString8[6][33] = {
	
	{'F',0x40,0x00,0x80,0x00,0x80,0x00,0xFF,0x7F,0x08,0x08,0x08,0x08,0x10,0x04,0x10,0x04,0x20,0x02,0x40,0x01,0x80,0x00,0x40,0x01,0x20,0x02,0x10,0x04,0x0C,0x18,0x03,0x60},/*"文",0*/
	{'F',0x10,0x04,0x10,0x04,0x90,0x04,0x88,0x04,0x88,0x3F,0x4C,0x04,0x4C,0x04,0x2A,0x04,0x09,0x04,0xE8,0x7F,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04,0x08,0x04},/*"件",1*/
	{'F',0x00,0x00,0xFE,0x3F,0x00,0x01,0x00,0x01,0x80,0x00,0x80,0x00,0xC0,0x02,0xA0,0x04,0x90,0x08,0x88,0x10,0x84,0x20,0x82,0x20,0x81,0x00,0x80,0x00,0x80,0x00,0x80,0x00},/*"不",2*/
	{'F',0x20,0x00,0x20,0x00,0xFF,0x7F,0x10,0x00,0x10,0x00,0xC8,0x1F,0x08,0x08,0x0C,0x04,0x0A,0x02,0xE9,0x7F,0x08,0x02,0x08,0x02,0x08,0x02,0x08,0x02,0x88,0x02,0x08,0x01},/*"存",3*/
	{'F',0x40,0x00,0x40,0x00,0x20,0x00,0xFF,0x7F,0x10,0x00,0x10,0x02,0x08,0x02,0x0C,0x02,0xEA,0x3F,0x09,0x02,0x08,0x02,0x08,0x02,0x08,0x02,0x08,0x02,0xF8,0x7F,0x08,0x00},/*"在",4*/
	{'F',0x00,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x08,0x00,0x00,0x00,0x00,0x00},/*"！",5*/

};

const unsigned char HzString9[6][33] =
{
	
	{'F',0x00,0x00,0x80,0x3F,0x80,0x1F,0x80,0x0F,0x80,0x07,0x80,0x07,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x07,0x80,0x07,0x80,0x0F,0x80,0x1F,0x80,0x3F,0x00,0x00},/*"【",0*/
	{'F',0x00,0x08,0x00,0x1F,0xFC,0x00,0x80,0x00,0x80,0x00,0xFC,0x1F,0x80,0x00,0x80,0x00,0x80,0x00,0xFF,0x7F,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0xA0,0x00,0x40,0x00},/*"手",1*/
	{'F',0x00,0x02,0x00,0x02,0x3E,0x02,0x00,0x02,0x80,0x3F,0x00,0x22,0x7F,0x22,0x04,0x22,0x04,0x22,0x04,0x21,0x12,0x21,0x22,0x21,0xBF,0x20,0xA2,0x20,0x40,0x14,0x20,0x08},/*"动",2*/
	{'F',0x00,0x09,0x04,0x09,0x08,0x09,0xC8,0x3F,0x00,0x09,0x00,0x09,0x0F,0x09,0xE8,0x7F,0x08,0x09,0x08,0x09,0x88,0x08,0x88,0x08,0x48,0x08,0x14,0x00,0xE2,0x7F,0x00,0x00},/*"进",3*/
	{'F',0x20,0x00,0x40,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x40,0x01,0x40,0x01,0x40,0x01,0x20,0x02,0x20,0x02,0x10,0x04,0x10,0x04,0x08,0x08,0x04,0x08,0x02,0x10,0x01,0x60},/*"入",4*/
	{'F',0x00,0x00,0xFC,0x01,0xF8,0x01,0xF0,0x01,0xE0,0x01,0xE0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xE0,0x01,0xE0,0x01,0xF0,0x01,0xF8,0x01,0xFC,0x01,0x00,0x00},/*"】",5*/


};

const unsigned char HzString10[7][33] = {
	{'F',0x00,0x00,0x80,0x3F,0x80,0x1F,0x80,0x0F,0x80,0x07,0x80,0x07,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x03,0x80,0x07,0x80,0x07,0x80,0x0F,0x80,0x1F,0x80,0x3F,0x00,0x00},/*"【",0*/
	{'F',0x10,0x04,0x92,0x04,0x54,0x04,0x10,0x7C,0xFF,0x22,0x54,0x22,0x92,0x22,0x11,0x25,0x08,0x14,0x7F,0x14,0x44,0x08,0x42,0x08,0x26,0x14,0x18,0x14,0x2C,0x22,0x43,0x41},/*"数",1*/
	{'F',0x04,0x00,0xC4,0x3F,0x44,0x20,0x44,0x20,0xDF,0x3F,0x44,0x04,0x44,0x04,0xD4,0x7F,0x4C,0x04,0x47,0x04,0x44,0x3F,0x44,0x21,0x44,0x21,0x24,0x21,0x25,0x3F,0x12,0x21},/*"据",2*/
	{'F',0x00,0x00,0xFE,0x3F,0x02,0x00,0x02,0x08,0x22,0x08,0x42,0x04,0x82,0x02,0x02,0x01,0x82,0x02,0x42,0x04,0x22,0x08,0x12,0x08,0x02,0x00,0x02,0x00,0xFE,0x7F,0x00,0x00},/*"区",3*/
	{'F',0x00,0x00,0xFC,0x0F,0x04,0x08,0x04,0x08,0xFC,0x0F,0x04,0x20,0x04,0x20,0xF8,0x3F,0x00,0x00,0x10,0x04,0x10,0x04,0xFF,0x7F,0x10,0x04,0x08,0x04,0x04,0x04,0x02,0x04},/*"异",4*/
	{'F',0x80,0x00,0x88,0x08,0x90,0x04,0xFE,0x7F,0x02,0x40,0xF9,0x2F,0x08,0x08,0xF8,0x0F,0x80,0x00,0xFC,0x1F,0x84,0x10,0x84,0x10,0x84,0x14,0x84,0x08,0x80,0x00,0x80,0x00},/*"常",5*/
	{'F',0x00,0x00,0xFC,0x01,0xF8,0x01,0xF0,0x01,0xE0,0x01,0xE0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xC0,0x01,0xE0,0x01,0xE0,0x01,0xF0,0x01,0xF8,0x01,0xFC,0x01,0x00,0x00},/*"】",6*/

};


unsigned char *vbuf;

GraphicMessage GM;
GraphicTextOutArgs text1;
BYTE work[FF_MAX_SS];

static void Hz16chOut(const unsigned char** HZlist,unsigned int len, unsigned int x, unsigned int y){
	unsigned char c,i;
	const unsigned char *p;
	unsigned char mode = 0;
	p = (const unsigned char *)HZlist;
	while(len){
		c=0;
		i=0;
		c = *p;
		p++;
		if(c == 'F'){
			if(x+16>256){
				x=0;
				y+=16;
			}
			for(int ly = 0; ly < 32; ly ++){
					c = *p;
					for(int lx = 0; lx < 8; lx++){
						
						if(c&1){
							vbuf[(x++) + 258 * y ] = 0xFF;
						}else{
							vbuf[(x++) + 258 * y ] = 0;
						}
						c=c>>1;
					}
						i++;
						p++;
					if((int)i % 2 == 0){
						y++;
						x-=16;
					}
			}
			x+=16;
			y-=16;
		}else{
			if(x+8>256){
				x=0;
				y+=16;
			}
			for(int ly = 0; ly < 16; ly ++){
					c = *p;
					for(int lx = 0; lx < 8; lx++){
						
						if(c&1){
							vbuf[(x++) + 258 * y ] = 0xFF;
						}else{
							vbuf[(x++) + 258 * y ] = 0;
						}
						c=c>>1;
					}
						p++;
						y++;
						x-=8;
			}
			x+=8;
			y-=16;
			p+=16;
		}
		len--;
	}
	
	GM.type = GRAPHIC_MSG_TYPE_FLUSH;
	xQueueSend(GraphicQueue, &(GM.selfAddr), ( TickType_t ) 0 );
}


int stat;

void displayRecovery(){
	GM.type = GRAPHIC_MSG_TYPE_CLEAR;
	xQueueSend(GraphicQueue, &(GM.selfAddr), ( TickType_t ) 0 );	
	
	switch (stat){
		case 1:
			Hz16chOut((const unsigned char**)&HzString9,6,1+16*7,1);
		break;
		
		case 2:
			Hz16chOut((const unsigned char**)&HzString10,7,1+16*7,1);
		break;
		
		default:
		
		break;
	}
	
	
	Hz16chOut((const unsigned char**)&HzString1,7,1,1);
	Hz16chOut((const unsigned char**)&HzString2,53,1+32, 1 + 16 * 1);
	Hz16chOut((const unsigned char**)&HzString3,5,1+32,1 + 16 * 4);
	Hz16chOut((const unsigned char**)&HzString4,12,1+32,1 + 16 * 5);
	Hz16chOut((const unsigned char**)&HzString5,9,1+32,1 + 16 * 6);
	
}

extern unsigned int FSOK;

void runInRecoverMode(){
	
	for(;;)
	{
		if(is_key_down(KEY_2))
			{
			GM.type = GRAPHIC_MSG_TYPE_CLEAR;
			xQueueSend(GraphicQueue, &(GM.selfAddr), ( TickType_t ) 0 );	
			vTaskDelay(100);
			if(isRawFlash()){
				
				//Hz16chOut((const unsigned char**)&HzString6,9,1+32,1 + 16 * 3);
				//vTaskDelay(1000);
				resetFlashRegionInfo();
				flashMapReset();
				
				//goto next_loop;
			}
			
			Hz16chOut((const unsigned char**)&HzString5,9 + 3 ,1+32,1 + 16 * 3);
			

			vTaskDelay(1000);
			FSOK = 0;

			lockFmap(true);
			flashMapClear();
			
			printf("start earsing\n");
			for(int i=getDataRegonStartBlock(); i<getDataRegonStartBlock() + getDataRegonTotalBlocks(); i++){
		
				xEraseFlashBlocks(i, 1, 5000);
				vTaskDelay(1);
				
			}
			
			flashMapReset();
			
			MKFS_PARM opt;
			opt.fmt = FM_FAT;
			opt.au_size = 2048;
			opt.align = 2048;
			
			FATFS fs;
			
			int fr = f_mkfs("", &opt, work, sizeof work);
			
			printf("format :%d\n",fr);
			
			
			f_mount(&fs, "/", 1);
			f_mkdir("/update");
			
			lockFmap(false);
			printf("format done.\n");
			
			FSOK = 1;
			
			stat = 0;
			
			Hz16chOut((const unsigned char**)&HzString7,2,1+16* 10,1 + 16 * 4);

			vTaskDelay(2000);
			
			flashSyncNow();
			displayRecovery();
		}
		
		
		
		
		
		if(is_key_down(KEY_ENTER))
		{
			
			GM.type = GRAPHIC_MSG_TYPE_CLEAR;
			xQueueSend(GraphicQueue, &(GM.selfAddr), ( TickType_t ) 0 );	
			vTaskDelay(100);			
			
			
			flashSyncNow();
			
			f_unmount("/");
			FATFS fs;
			FIL romfile;
			int fr = f_mount(&fs, "/", 1);
			
			if(fr != 0 || !FSOK){
				Hz16chOut((const unsigned char**)&HzString8,6,1+32,1 + 16 * 3);
				vTaskDelay(1000);
				lockFmap(false);
				displayRecovery();
				goto next_loop;
			}
			
			
			lockFmap(true);
			
			
			fr = f_open(&romfile,"/update/firmware.sb",FA_READ);
			if(fr != 0){
				Hz16chOut((const unsigned char**)&HzString8,6,1+32,1 + 16 * 3);
				vTaskDelay(1000);
				lockFmap(false);
				displayRecovery();
				goto next_loop;
			}
			
			resetFlashRegionInfo();
			eraseBootimgRegion();
			
			unsigned char *rombuffer = pvPortMalloc(64*1024);
			UINT br;
			
			
			f_lseek(&romfile, 0);
			

			for(int i=0; i < f_size(&romfile) / (64 * 1024); i++){
				
				fr = f_read(&romfile, rombuffer, 64*1024, &br);
				installBootimgInPage(i,rombuffer);
				f_lseek(&romfile, i*(64 * 1024));
			}
			
			vPortFree(rombuffer);
			
			lockFmap(false);
			
			stat = 0;
			
			
			Hz16chOut((const unsigned char**)&HzString7,2,1+16* 10,1 + 16 * 4);
			vTaskDelay(2000);
			
			displayRecovery();
		}
		
		
		
		next_loop:
		
		vTaskDelay(100);
	}
	
}

void vInit(){
	vTaskDelay(200);
	/*
	GM.selfAddr = &GM;
	GM.type = GRAPHIC_MSG_TYPE_CLEAR;
	xQueueSend(GraphicQueue, &(GM.selfAddr), ( TickType_t ) 0 );
	
	GM.type = GRAPHIC_MSG_TYPE_TEXTOUT;
	GM.argsList = &text1;
	text1.x = 1;
	text1.y = 1;
	text1.area_width = 100;
	text1.area_height = 16;
	text1.font_size = 12;
	text1.font_color = 255;
	text1.text = "Test a";
	xQueueSend(GraphicQueue, &(GM.selfAddr) , ( TickType_t ) 0 );
	*/
	xTaskCreate( vCDC_Console, "CDC Console", configMINIMAL_STACK_SIZE, NULL, 3, NULL );

	GM.selfAddr = &GM;
	GM.type = GRAPHIC_MSG_TYPE_CLEAR;
	xQueueSend(GraphicQueue, &(GM.selfAddr), ( TickType_t ) 0 );
	vbuf = (char *) getVramAddress();
	
	
	
	
	if(is_key_down(KEY_PLUS)){
		stat = 1;
		displayRecovery();
		runInRecoverMode();
	}
	if(!isfatFsInited()){
		stat = 2;
		displayRecovery();
		runInRecoverMode();
	}
	
	
	GM.selfAddr = &GM;
	GM.type = GRAPHIC_MSG_TYPE_CLEAR;
	xQueueSend(GraphicQueue, &(GM.selfAddr), ( TickType_t ) 0 );	
	//modifyRegion(0,22,49);
	//saveRegionTable();
	

	
	
	vTaskDelete(NULL);
	for(;;){}
}